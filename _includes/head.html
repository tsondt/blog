<head>
  {% assign meta_title = page.title | default: site.name %}
  {% assign meta_description = page.description | default: site.description | default: site.name %}
  {% assign meta_description = meta_description | strip_html | strip_newlines | truncate: 160 %}
  {% assign meta_type = page.og_type | default: 'website' %}
  {% assign meta_url = page.url | absolute_url %}
  {% assign meta_image = page.thumb_image | default: site.social_image %}
  {% assign meta_image_alt = page.thumb_image_alt | default: page.image_alt | default: meta_title %}
  {% assign meta_locale = site.locale | default: 'en_US' %}
  {% assign x_profile = site.social.x | default: '' %}
  {% assign x_handle = x_profile | replace: 'https://x.com/', '' | replace: 'http://x.com/', '' | replace: 'https://www.x.com/', '' | replace: 'http://www.x.com/', '' | split: '/' | first | strip %}
  {% if meta_image %}
    {% assign meta_image = meta_image | absolute_url %}
  {% endif %}
  {% assign twitter_card = 'summary' %}
  {% if meta_image %}
    {% assign twitter_card = 'summary_large_image' %}
  {% endif %}

  <title>{{ site.name }}{% unless meta_title == site.name %} | {{ meta_title | escape }}{% endunless %}</title>
  <meta name="description" content="{{ meta_description | escape }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="canonical" href="{{ meta_url }}">

  <meta property="og:title" content="{{ meta_title | escape }}">
  <meta property="og:type" content="{{ meta_type }}">
  <meta property="og:url" content="{{ meta_url }}">
  <meta property="og:description" content="{{ meta_description | escape }}">
  <meta property="og:site_name" content="{{ site.name }}">
  <meta property="og:locale" content="{{ meta_locale }}">
  {% if meta_image %}
  <meta property="og:image" content="{{ meta_image }}">
  <meta property="og:image:secure_url" content="{{ meta_image }}">
  <meta property="og:image:alt" content="{{ meta_image_alt | escape }}">
  {% endif %}

  <meta name="twitter:card" content="{{ twitter_card }}">
  <meta name="twitter:url" content="{{ meta_url }}">
  <meta name="twitter:title" content="{{ meta_title | escape }}">
  <meta name="twitter:description" content="{{ meta_description | escape }}">
  {% if meta_image %}
  <meta name="twitter:image" content="{{ meta_image }}">
  <meta name="twitter:image:alt" content="{{ meta_image_alt | escape }}">
  {% endif %}
  {% if x_handle != '' %}
  <meta name="twitter:site" content="@{{ x_handle }}">
  <meta name="twitter:creator" content="@{{ x_handle }}">
  {% endif %}

  <link href="{{ 'feed.xml' | absolute_url }}" type="application/rss+xml" rel="alternate" title="{{ site.name }} Last 10 blog posts" />
  <script>
  (function() {
    try {
      var stored = localStorage.getItem('theme');
      var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      var theme = stored ? stored : (prefersDark ? 'dark' : 'light');
      document.documentElement.dataset.theme = theme;
    } catch (e) {
      document.documentElement.dataset.theme = 'light';
    }
  })();
  </script>
  <link rel="stylesheet" href="/assets/css/main.css" data-theme="light" media="(prefers-color-scheme: light)">
  <link rel="stylesheet" href="/assets/css/main-dark.css" data-theme="dark" media="(prefers-color-scheme: dark)">
  <script>
  (function() {
    var theme = document.documentElement.dataset.theme;
    var lightSheet = document.querySelector('link[data-theme="light"]');
    var darkSheet = document.querySelector('link[data-theme="dark"]');
    if (!lightSheet || !darkSheet) {
      return;
    }
    if (theme === 'dark') {
      lightSheet.media = 'not all';
      darkSheet.media = 'all';
    } else {
      lightSheet.media = 'all';
      darkSheet.media = 'not all';
    }
  })();
  </script>
  {% if jekyll.environment != "development" %}
  {% if site.ga_id %}
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.ga_id }}', 'auto');
  ga('send', 'pageview');

  </script>
  {% endif %}
  {% endif %}
</head>
